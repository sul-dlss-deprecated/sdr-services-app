<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Sdr::ArchiveCatalogAPI
  
    &mdash; SDR Services REST API Documentation
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!Sdr/ArchiveCatalogAPI.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (A)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Sdr.html" title="Sdr (module)">Sdr</a></span></span>
     &raquo; 
    <span class="title">ArchiveCatalogAPI</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Sdr::ArchiveCatalogAPI
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Sinatra::Base</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Sinatra::Base</li>
          
            <li class="next">Sdr::ArchiveCatalogAPI</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/sdr/archive_catalog_api.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This API provides a RESTful interface to the Archive Catalog for the
Stanford Digital Repository.  This is SDR metadata, primarily data for
tracking replication of objects in the preservation core.</p>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="sdr_druid_regex-classvariable" class="">@@sdr_druid_regex =
          
        </dt>
        <dd><pre class="code"><span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>[[:lower:]]{2}[[:digit:]]{3}[[:lower:]]{2}[[:digit:]]{4}</span><span class='tstring_end'>&#39;</span></span></pre></dd>
      
        <dt id="digital_object_schema-classvariable" class="">@@digital_object_schema =
          
        </dt>
        <dd><pre class="code"><span class='heredoc_beg'>&lt;&lt;-END_JSON_SCHEMA_STR</span>
<span class='tstring_content'>{
  &quot;type&quot;:&quot;object&quot;,
  &quot;title&quot;:&quot;Digital Object Identifier&quot;,
  &quot;description&quot;:&quot;An object in a digital repository.&quot;,
  &quot;additionalProperties&quot;:false,
  &quot;properties&quot;:{
    &quot;digital_object_id&quot;:{ &quot;type&quot;:&quot;string&quot;, &quot;required&quot;: true },
    &quot;home_repository&quot;:{ &quot;type&quot;:&quot;string&quot;, &quot;required&quot;: true }
  }
}
</span><span class='heredoc_end'>END_JSON_SCHEMA_STR</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_archive_digital_objects_home_repository-instance_method" title="#GET (instance method)">- (Object) <strong>GET</strong>(&quot;/archive/digital_objects/:home_repository&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A set of digital objects in home_repository.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_archive_digital_objects_home_repository_digital_object_id-instance_method" title="#GET (instance method)">- (Object) <strong>GET</strong>(&quot;/archive/digital_objects/:home_repository/:digital_object_id&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A digital object record.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_archive_digital_objects_objects-instance_method" title="#GET (instance method)">- (Object) <strong>GET</strong>(&quot;/archive/digital_objects/objects&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A set of digital objects.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_archive_digital_objects_repositories-instance_method" title="#GET (instance method)">- (Object) <strong>GET</strong>(&quot;/archive/digital_objects/repositories&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>response:   [“sdr”,“etc”].</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#put_archive_digital_objects_home_repository_digital_object_id-instance_method" title="#PUT (instance method)">- (Object) <strong>PUT</strong>(&quot;/archive/digital_objects/:home_repository/:digital_object_id&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>An HTTP status for PUT success (201 created, 204 exists) or failure (400+).</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="get_archive_digital_objects_home_repository-instance_method">
  
    - (<tt>Object</tt>) <strong>GET</strong>(&quot;/archive/digital_objects/:home_repository&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>response data can be paginated, @see <a
href="https://developer.github.com/v3/#pagination">developer.github.com/v3/#pagination</a></p>
</div>
  </div>


<p>Returns a set of digital objects in home_repository</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code>request:
  SDR_ROUTE=&#39;/archive/digital_objects/sdr&#39;
  curl -v -u ${SDR_USER}:${SDR_PASS} http://${SDR_HOST}:${SDR_PORT}${SDR_ROUTE}
response:
  [{&quot;digital_object_id&quot;:&quot;druid:bb002mz7474&quot;,&quot;home_repository&quot;:&quot;sdr&quot;},
   {&quot;digital_object_id&quot;:&quot;druid:jq937jp0017&quot;,&quot;home_repository&quot;:&quot;sdr&quot;}]</code></pre>
    
  </div>

  
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>home_repository</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>use values in /archive/repositories [required]</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>a set of digital objects in home_repository</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


210
211
212
213
214
215
216
217
218
219
220
221</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sdr/archive_catalog_api.rb', line 210</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/archive/digital_objects/:home_repository</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_dataset'>dataset</span> <span class='op'>=</span> <span class='const'>ArchiveCatalogSQL</span><span class='op'>::</span><span class='const'>DigitalObject</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:home_repository</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:home_repository</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_http_pagination'>http_pagination</span><span class='lparen'>(</span><span class='id identifier rubyid_dataset'>dataset</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_error'>error</span> <span class='int'>404</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Did not find any digital objects in the </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:home_repository</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> repository.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_response_negotiation'>response_negotiation</span><span class='lparen'>(</span><span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:root</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>digital_objects</span><span class='tstring_end'>&#39;</span></span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span>
    <span class='id identifier rubyid_error'>error</span> <span class='int'>500</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to process the </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:home_repository</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> repository.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_archive_digital_objects_home_repository_digital_object_id-instance_method">
  
    - (<tt>Object</tt>) <strong>GET</strong>(&quot;/archive/digital_objects/:home_repository/:digital_object_id&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a digital object record</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code>request:
  SDR_ROUTE=&#39;/archive/digital_objects/sdr/druid:bb002mz7474&#39;
  curl -v -u ${SDR_USER}:${SDR_PASS} http://${SDR_HOST}:${SDR_PORT}${SDR_ROUTE}
response:
  [{&quot;digital_object_id&quot;:&quot;druid:bb002mz7474&quot;,&quot;home_repository&quot;:&quot;sdr&quot;}]</code></pre>
    
  </div>

  
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>home_repository</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>use values in /archive/repositories [required]</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>digital_object_id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Digital-Object-ID, such as DRUID-ID, DPN-ID, etc. [required]</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>a digital object record</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


233
234
235
236
237
238
239
240
241
242
243
244</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sdr/archive_catalog_api.rb', line 233</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/archive/digital_objects/:home_repository/:digital_object_id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_digital_object'>digital_object</span> <span class='op'>=</span> <span class='id identifier rubyid_digital_object_from_params'>digital_object_from_params</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='const'>ArchiveCatalogSQL</span><span class='op'>::</span><span class='const'>DigitalObject</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='id identifier rubyid_digital_object'>digital_object</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_error'>error</span> <span class='int'>404</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Did not find </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:digital_object_id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> in the </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:home_repository</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> repository.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_response_negotiation'>response_negotiation</span><span class='lparen'>(</span><span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:root</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>digital_objects</span><span class='tstring_end'>&#39;</span></span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span>
    <span class='id identifier rubyid_error'>error</span> <span class='int'>500</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to process </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:digital_object_id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> in the </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:home_repository</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> repository.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_archive_digital_objects_objects-instance_method">
  
    - (<tt>Object</tt>) <strong>GET</strong>(&quot;/archive/digital_objects/objects&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>response status 206 indicates the response is <a
href="https://developer.github.com/v3/#pagination">paginated</a></p>
</div>
  </div>


<p>Returns a set of digital objects</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code>request:
  SDR_ROUTE=&#39;/archive/digital_objects/objects&#39;
  curl -v -u ${SDR_USER}:${SDR_PASS} http://${SDR_HOST}:${SDR_PORT}${SDR_ROUTE}
response:
  [{&quot;digital_object_id&quot;:&quot;druid:bb002mz7474&quot;,&quot;home_repository&quot;:&quot;sdr&quot;},
   {&quot;digital_object_id&quot;:&quot;druid:jq937jp0017&quot;,&quot;home_repository&quot;:&quot;sdr&quot;}]</code></pre>
    
  </div>

  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>a set of digital objects</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


191
192
193
194
195
196
197</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sdr/archive_catalog_api.rb', line 191</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/archive/digital_objects/objects</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='comment'># Return everything about the objects, including the :home_repository.
</span>  <span class='comment'># digital_object_id is a primary key, so .distinct is not required here.
</span>  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_http_pagination'>http_pagination</span><span class='lparen'>(</span><span class='const'>ArchiveCatalogSQL</span><span class='op'>::</span><span class='const'>DigitalObject</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_response_negotiation'>response_negotiation</span><span class='lparen'>(</span><span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:root</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>digital_objects</span><span class='tstring_end'>&#39;</span></span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_status'>status</span> <span class='int'>206</span> <span class='kw'>unless</span> <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_page_count'>page_count</span> <span class='op'>==</span> <span class='int'>1</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_archive_digital_objects_repositories-instance_method">
  
    - (<tt>Object</tt>) <strong>GET</strong>(&quot;/archive/digital_objects/repositories&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>response:</p>

<pre class="code ruby"><code class="ruby"><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sdr</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>etc</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span></code></pre>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code>SDR_ROUTE=&#39;/archive/digital_objects/repositories&#39;
curl -v -u ${SDR_USER}:${SDR_PASS} http://${SDR_HOST}:${SDR_PORT}${SDR_ROUTE}</code></pre>
    
  </div>

  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>a set of repository identifiers</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


176
177
178
179</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sdr/archive_catalog_api.rb', line 176</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/archive/digital_objects/repositories</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='const'>ArchiveCatalogSQL</span><span class='op'>::</span><span class='const'>DigitalObject</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='symbol'>:home_repository</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_distinct'>distinct</span>
  <span class='id identifier rubyid_response_negotiation'>response_negotiation</span><span class='lparen'>(</span><span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span><span class='lbracket'>[</span><span class='symbol'>:home_repository</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:root</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>repositories</span><span class='tstring_end'>&#39;</span></span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="put_archive_digital_objects_home_repository_digital_object_id-instance_method">
  
    - (<tt>Object</tt>) <strong>PUT</strong>(&quot;/archive/digital_objects/:home_repository/:digital_object_id&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns an HTTP status for PUT success (201 created, 204 exists) or failure
(400+)</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code>SDR_DATA=&#39;{&quot;digital_object_id&quot;: &quot;druid:bb002mz7474&quot;, &quot;home_repository&quot;: &quot;sdr&quot;}&#39;
SDR_ROUTE=&#39;/archive/digital_objects/sdr/druid:bb002mz7474&#39;
curl -v -X PUT -H &quot;Content-Type: application/json&quot; --data &quot;${SDR_DATA}&quot; \
     -u ${SDR_USER}:${SDR_PASS} http://${SDR_HOST}:${SDR_PORT}${SDR_ROUTE}</code></pre>
    
  </div>

  
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>home_repository</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>use values in /archive/repositories</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>digital_object_id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Digital-Object-ID, such as DRUID-ID, DPN-ID, etc. [required]</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>an HTTP status for PUT success (201 created, 204 exists) or failure (400+)</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sdr/archive_catalog_api.rb', line 258</span>

<span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/archive/digital_objects/:home_repository/:digital_object_id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>

  <span class='comment'>#binding.pry
</span>
  <span class='comment'># PUT: Store the Entity-Body at the URL
</span>  <span class='id identifier rubyid_digital_object_params'>digital_object_params</span> <span class='op'>=</span> <span class='id identifier rubyid_digital_object_from_params'>digital_object_from_params</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_digital_object_data'>digital_object_data</span> <span class='op'>=</span> <span class='id identifier rubyid_digital_object_from_body'>digital_object_from_body</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_digital_object_data'>digital_object_data</span> <span class='op'>==</span> <span class='id identifier rubyid_digital_object_params'>digital_object_params</span>
    <span class='id identifier rubyid_error'>error</span> <span class='int'>422</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>URI does not match json data: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_digital_object_data'>digital_object_data</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='comment'># Try to find an existing object.
</span>  <span class='id identifier rubyid_objects'>objects</span> <span class='op'>=</span> <span class='const'>ArchiveCatalogSQL</span><span class='op'>::</span><span class='const'>DigitalObject</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='id identifier rubyid_digital_object_data'>digital_object_data</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_objects'>objects</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='int'>2</span>
    <span class='comment'># digital_object_id is a primary key, so we can only get 0 or 1 results
</span>    <span class='id identifier rubyid_error'>error</span> <span class='int'>500</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Too many matching objects: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_objects'>objects</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_objects'>objects</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='comment'># If the target resource does not have a current representation and the
</span>    <span class='comment'># PUT successfully creates one, then the origin server MUST inform the
</span>    <span class='comment'># user agent by sending a 201 (Created) response.
</span>    <span class='kw'>begin</span>
      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'>ArchiveCatalogSQL</span><span class='op'>::</span><span class='const'>DigitalObject</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='id identifier rubyid_digital_object_data'>digital_object_data</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='int'>0</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_success'>success</span>
        <span class='id identifier rubyid_halt'>halt</span> <span class='int'>201</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Location</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_route'>route</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Digital object created.</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_error'>error</span> <span class='int'>500</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span>
      <span class='comment'>#TODO: ony catch Sequel exceptions here?
</span>      <span class='id identifier rubyid_error'>error</span> <span class='int'>500</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='comment'># If the target resource does have a current representation and that representation
</span>    <span class='comment'># is successfully modified in accordance with the state of the request
</span>    <span class='comment'># representation, then either a 200 (OK) or 204 (No Content) response
</span>    <span class='comment'># SHOULD be sent to indicate successful completion of the request.
</span>    <span class='id identifier rubyid_obj'>obj</span> <span class='op'>=</span> <span class='id identifier rubyid_objects'>objects</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span> <span class='op'>==</span> <span class='id identifier rubyid_digital_object_data'>digital_object_data</span>
      <span class='comment'># The request representation already exists, do nothing.
</span>      <span class='id identifier rubyid_status'>status</span> <span class='int'>204</span>
      <span class='comment'>#halt 201, &#39;/archive/:home_repository/object/:digital_object_id&#39;
</span>      <span class='comment'>#halt 202, {&#39;Location&#39; =&gt; &quot;/messages/#{message.id}&quot;}, &#39;&#39;
</span>    <span class='kw'>else</span>
      <span class='comment'># The new representation should replace the existing representation.
</span>      <span class='comment'># A partial update could be a PATCH request, whereas a PUT must entirely
</span>      <span class='comment'># replace the resource content at this route. A PUT is idempotent.
</span>      <span class='kw'>begin</span>
        <span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span>
        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'>ArchiveCatalogSQL</span><span class='op'>::</span><span class='const'>DigitalObject</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='id identifier rubyid_digital_object_data'>digital_object_data</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='int'>0</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_success'>success</span>
          <span class='id identifier rubyid_status'>status</span> <span class='int'>201</span>
          <span class='comment'># TODO
</span>          <span class='comment'>#halt 201, &#39;/archive/:home_repository/object/:digital_object_id&#39;
</span>          <span class='comment'>#halt 202, {&#39;Location&#39; =&gt; &quot;/messages/#{message.id}&quot;}, &#39;&#39;
</span>        <span class='kw'>else</span>
          <span class='id identifier rubyid_error'>error</span>
        <span class='kw'>end</span>

      <span class='kw'>rescue</span>
        <span class='comment'>#TODO: ony catch Sequel exceptions here?
</span>        <span class='id identifier rubyid_error'>error</span> <span class='int'>500</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Wed Nov 12 16:19:25 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.3).
</div>

  </body>
</html>